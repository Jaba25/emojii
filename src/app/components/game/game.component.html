<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBackToMenu()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
      <div class="category-name">{{ categoryTitle }}</div>
    </ion-buttons>
    <ion-title>рЃњрЃљрЃЏрЃЮрЃўрЃфрЃљрЃюрЃў рЃћрЃЏрЃЮрЃ»рЃў</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="goToMainPage()">
        <ion-icon name="home-outline" slot="start"></ion-icon>
        рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="game-content" *ngIf="gameState">
  
  <!-- Game Status Bar -->
  <div class="status-bar">
    
    <!-- Progress -->
    <div class="progress-section">
      <div class="progress-label">
        рЃЎрЃўрЃЌрЃ«рЃЋрЃљ {{ gameState.currentQuestionIndex + 1 }} / {{ gameState.questions.length }}
      </div>
      <ion-progress-bar 
        [value]="getProgressPercentage() / 100" 
        color="secondary">
      </ion-progress-bar>
    </div>

    <!-- Coins and Score -->
    <div class="stats-row">
      <div class="coins-section">
        <span class="coins-label">­ЪфЎ рЃЏрЃЮрЃюрЃћрЃбрЃћрЃЉрЃў:</span>
        <span class="coins-value">{{ gameState.coins }}</span>
      </div>
      
      <div class="score-section">
        <span class="score-label">рЃЦрЃБрЃџрЃљ:</span>
        <span class="score-value">{{ gameState.score }}</span>
      </div>
    </div>

  </div>

  <!-- Question Section -->
  <div class="question-container" *ngIf="gameState.currentQuestion">
    
    <!-- Emoji Display -->
    <div class="emoji-display">
      <div class="emoji-text" [class.long-sequence]="isLongEmojiSequence()">{{ gameState.currentQuestion.emojis }}</div>
      <div class="difficulty-badge" [class]="'difficulty-' + gameState.currentQuestion.difficulty">
        {{ getDifficultyText(gameState.currentQuestion.difficulty) }}
      </div>
    </div>

    <!-- Hint Options Section -->
    <div class="hint-options-section" *ngIf="showHintOptions">
      <ion-card class="hint-options-card">
        <ion-card-content>
          <div class="hint-options-header">
            <div class="hint-icon">­ЪњА</div>
            <ion-button 
              fill="clear" 
              size="small" 
              (click)="closeHintOptions(); $event.stopPropagation()"
              class="close-button">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </div>
          <div class="hint-options-title">рЃљрЃўрЃарЃЕрЃўрЃћ рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃўрЃА рЃбрЃўрЃърЃў:</div>
          
          <div class="hint-buttons">
            <ion-button 
              expand="block" 
              class="hint-level-button easy-hint"
              [disabled]="!canUseHint('easy')"
              (click)="useHint('easy')">
              <div class="hint-button-content">
                <div class="hint-level">рЃЏрЃљрЃарЃбрЃўрЃЋрЃў рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
                <div class="hint-cost">10 ­ЪфЎ</div>
                <div class="hint-description">рЃќрЃЮрЃњрЃљрЃЊрЃў рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
              </div>
            </ion-button>

            <ion-button 
              expand="block" 
              class="hint-level-button medium-hint"
              [disabled]="!canUseHint('medium')"
              (click)="useHint('medium')">
              <div class="hint-button-content">
                <div class="hint-level">рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
                <div class="hint-cost">20 ­ЪфЎ</div>
                <div class="hint-description">рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
              </div>
            </ion-button>

            <ion-button 
              expand="block" 
              class="hint-level-button hard-hint"
              [disabled]="!canUseHint('hard')"
              (click)="useHint('hard')">
              <div class="hint-button-content">
                <div class="hint-level">рЃарЃЌрЃБрЃџрЃў рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
                <div class="hint-cost">30 ­ЪфЎ</div>
                <div class="hint-description">рЃФрЃџрЃўрЃћрЃарЃў рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ</div>
              </div>
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Active Hint Section -->
    <div class="hint-section" *ngIf="showHint">
      <ion-card class="hint-card">
        <ion-card-content>
          <div class="hint-header">
            <div class="hint-info">
              <div class="hint-icon">­ЪњА</div>
              <div class="hint-level-label">{{ getHintLevelText() }}</div>
            </div>
            <ion-button 
              fill="clear" 
              size="small" 
              (click)="closeHint(); $event.stopPropagation()"
              class="close-button">
              <ion-icon name="close-outline"></ion-icon>
            </ion-button>
          </div>
          <div class="hint-text">{{ currentHint }}</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Revealed Answer Section -->
    <div class="answer-reveal-section" *ngIf="showRevealedAnswer">
      <ion-card class="answer-reveal-card">
        <ion-card-content>
          <div class="answer-header">
            <div class="answer-icon">­ЪЊќ</div>
            <ion-button 
              fill="clear" 
              size="small" 
              (click)="closeRevealedAnswer()"
              class="close-button">
              <ion-icon name="close-outline" style="color: white;"></ion-icon>
            </ion-button>
          </div>
          <div class="answer-label">рЃърЃљрЃАрЃБрЃ«рЃў:</div>
          <div class="answer-text">{{ revealedAnswer }}</div>
          
          <!-- Next Question Button -->
          <ion-button 
            class="next-question-button"
            expand="block" 
            (click)="goToNextQuestion()"
            color="success">
            рЃерЃћрЃЏрЃЊрЃћрЃњрЃў рЃЎрЃўрЃЌрЃ«рЃЋрЃљ РъА№ИЈ
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Answer Input - Only show when hint, hint options and revealed answer are not shown -->
    <div class="answer-section" *ngIf="!showHint && !showHintOptions && !showRevealedAnswer">
      <ion-item lines="none" class="answer-input">
        <ion-label position="stacked">рЃерЃћрЃюрЃў рЃърЃљрЃАрЃБрЃ«рЃў:</ion-label>
        <ion-input 
          [(ngModel)]="userAnswer"
          (keydown.enter)="submitAnswer()"
          placeholder="рЃЊрЃљрЃгрЃћрЃарЃћ рЃърЃљрЃАрЃБрЃ«рЃў рЃљрЃЦ..."
          clearInput="true">
        </ion-input>
      </ion-item>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="!showRevealedAnswer">
      
      <!-- Action Buttons Row -->
      <div class="action-buttons">
        <!-- Hint Button -->
        <ion-button 
          fill="outline" 
          color="warning"
          (click)="showHintOptions = true"
          [disabled]="showHint || showHintOptions"
          class="hint-button">
          <ion-icon name="bulb-outline" slot="start"></ion-icon>
          рЃЏрЃўрЃюрЃўрЃерЃюрЃћрЃЉрЃљ
        </ion-button>

        <!-- Show Answer Button -->
        <ion-button 
          fill="outline" 
          color="danger"
          (click)="showAnswer()"
          [disabled]="!canAffordShowAnswer()"
          class="show-answer-button">
          <ion-icon name="book-outline" slot="start"></ion-icon>
          рЃърЃљрЃАрЃБрЃ«рЃў - 50­ЪфЎ
        </ion-button>
      </div>

      <!-- Submit Button -->
      <ion-button 
        expand="block" 
        color="success"
        (click)="submitAnswer()"
        [disabled]="!userAnswer.trim()"
        class="submit-button">
        <ion-icon name="checkmark-outline" slot="start"></ion-icon>
        рЃърЃљрЃАрЃБрЃ«рЃўрЃА рЃњрЃљрЃњрЃќрЃљрЃЋрЃюрЃљ
      </ion-button>
      
    </div>

  </div>

  <!-- Game Over State -->
  <div class="game-over-container" *ngIf="gameState.gameStatus === 'finished'">
    <div class="game-over-content">
      <div class="game-over-icon">­Ъј«</div>
      <h2>рЃЌрЃљрЃЏрЃљрЃерЃў рЃЊрЃљрЃАрЃарЃБрЃџрЃЊрЃљ!</h2>
      <p>рЃерЃћрЃюрЃў рЃАрЃљрЃЉрЃЮрЃџрЃЮрЃЮ рЃЦрЃБрЃџрЃљ: <strong>{{ gameState.score }}</strong></p>
      <ion-button 
        expand="block" 
        color="primary"
        (click)="goBackToMenu()">
        рЃЏрЃЌрЃљрЃЋрЃљрЃа рЃЏрЃћрЃюрЃўрЃБрЃерЃў рЃЊрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃљ
      </ion-button>
    </div>
  </div>

</ion-content>

<!-- Loading State -->
<ion-content *ngIf="!gameState" class="loading-content">
  <div class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>рЃЌрЃљрЃЏрЃљрЃерЃў рЃўрЃбрЃЋрЃўрЃарЃЌрЃћрЃЉрЃљ...</p>
  </div>
</ion-content>
